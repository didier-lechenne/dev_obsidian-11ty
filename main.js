/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var A=(o,e)=>{for(var t in e)y(o,t,{get:e[t],enumerable:!0})},b=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of x(e))!$.call(o,s)&&s!==t&&y(o,s,{get:()=>e[s],enumerable:!(r=v(e,s))||r.enumerable});return o};var R=o=>b(y({},"__esModule",{value:!0}),o);var B={};A(B,{default:()=>u});module.exports=R(B);var w=require("obsidian");var E={col:"--col",printCol:"--print-col",width:"--width",printWidth:"--print-width",printRow:"--print-row",printHeight:"--print-height",alignSelf:"--align-self",alignself:"--align-self","align-self":"--align-self",imgX:"--img-x",imgY:"--img-y",imgW:"--img-w",page:"--pagedjs-full-page"},C=/\{%\s*(\w+)\s+([^%]+)\s*%\}/g,S=["image","grid","video","figure","imagenote","fullpage"],T={image:{template:'<figure id="{id}" data-type="{type}" data-grid="image" class="figure {type} {classes}" data-src="{src}"{styles}>{media}<figcaption class="figcaption">{caption}</figcaption></figure>'},imagenote:{template:'<span id="{id}" data-type="{type}" class="{type} {classes}" data-src="{src}"{styles}>{media}<span class="figcaption">{caption}</span></span>'},figure:{template:'<figure id="{id}" data-src="{src}" data-type="{type}" data-grid="image" class="{type} {classes}"{styles}>{media}<figcaption class="figcaption">{caption}</figcaption></figure>'},grid:{template:'<figure id="{id}" data-src="{src}" data-type="{type}" data-grid="image" class="figure {type} {classes}"{styles}>{media}</figure><figcaption class="figcaption"{styles}>{caption}</figcaption>'},fullpage:{template:'<figure id="{id}" data-src="{src}" data-type="{type}" data-grid="image" class="full-page figure {type} {classes}"{styles}>{media}</figure>'},video:{template:'<figure id="{id}" data-type="{type}" data-grid="content" class="video {classes}"{styles}>{media}<figcaption class="figcaption">{caption}</figcaption></figure>'}};function M(o){let e={};return Object.entries(o).forEach(([t,r])=>{if(E[t]&&r!==void 0&&r!==null&&r!==""){let s=typeof r=="string"?r.replace(/^["']|["']$/g,""):r;e[E[t]]=s}}),e}function P(o){return o?o.replace(/\*([^*]+)\*/g,"$1").replace(/<[^>]+>/g," ").replace(/&[^;]+;/g," ").replace(/\s+/g," ").trim():""}function k(o){return o.replace(/~~(.*?)~~/g,"<del>$1</del>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/<br>/g,"<br>")}function h(o){o=o.replace(/\s+/g," ").trim();let e=o.match(/^["']([^"']+)["'](?:\s*,\s*(\{.*\}))?$/)||o.match(/^([^,\s]+)(?:\s*,\s*(\{.*\}))?$/);if(!e){let s=o.indexOf(",");if(s>0){let i=o.substring(0,s).trim().replace(/^["']|["']$/g,""),c=o.substring(s+1).trim(),a={};if(c.startsWith("{"))try{let p=c.replace(/,(\s*[}\]])/g,"$1");a=Function(`"use strict"; return (${p})`)()}catch(p){console.warn("Erreur parsing options:",p)}return{src:i,options:a}}throw new Error("Format de param\xE8tres invalide")}let t=e[1],r={};if(e[2])try{let s=e[2].replace(/,(\s*[}\]])/g,"$1");r=Function(`"use strict"; return (${s})`)()}catch(s){console.warn("Erreur parsing options:",s),r={}}return{src:t,options:r}}var m=class{constructor(e){this.app=e;this.globalElementCounter=0}render(e,t){if(!S.includes(e))return console.warn(`Type de shortcode non support\xE9: ${e}`),null;let{src:r,options:s={}}=t,i={src:this.resolveImagePath(r),...s};this.globalElementCounter++;let c=T[e];if(!c)return null;let a={id:i.id||`${e}-${this.globalElementCounter}`,type:e,classes:i.class||"",src:i.src||"",media:this.createMediaElement(e,i),caption:i.caption?k(i.caption):"",styles:this.generateStylesString(i)},p=this.renderTemplate(c.template,a),n=document.createElement("div");n.innerHTML=p;let l=n.firstElementChild;if(l&&(this.addEditOnClick(l),e==="grid"&&n.children.length>1)){let d=document.createElement("div");return Array.from(n.children).forEach(g=>d.appendChild(g)),d}return l}resolveImagePath(e){if(!e)return"";if(e.startsWith("http")||e.startsWith("app://"))return e;let t=this.app.metadataCache.getFirstLinkpathDest(e,"");return t?this.app.vault.getResourcePath(t):`app://local/${encodeURIComponent(e)}`}renderTemplate(e,t){return e.replace(/{id}/g,t.id).replace(/{type}/g,t.type).replace(/{classes}/g,t.classes).replace(/{src}/g,t.src).replace(/{media}/g,t.media).replace(/{caption}/g,t.caption).replace(/{styles}/g,t.styles)}createMediaElement(e,t){return e==="video"?`<video controls${t.poster?` poster="${t.poster}"`:""}><source src="${t.src}"></video>`:`<img src="${t.src}" alt="${P(t.caption||"")}">`}generateStylesString(e){let t=M(e),r=Object.entries(t).map(([s,i])=>`${s}: ${i}`);return r.length>0?` style="${r.join("; ")}"`:""}addEditOnClick(e){e.style.cursor="pointer",e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();let r=this.findEditButton(e);r&&r.click()})}findEditButton(e){let t=e.parentElement;for(;t;){let r=t.querySelector(".edit-block-button");if(r)return r;t=t.parentElement}return null}};var f=class{constructor(e){this.app=e;this.renderer=new m(e)}processCodeBlock(e,t,r){let s=t.parentElement,i="";if(s&&s.className){let n=s.className.match(/block-language-(\w+)/);n&&(i=n[1])}if(i&&i!=="shortcode"){let n="",l={};if(e.trim())try{let g=h(e.trim());n=g.src||"",l=g.options}catch(g){n=e.trim().replace(/['"]/g,"")}let d=this.renderer.render(i,{src:n,options:l});d&&t.appendChild(d);return}let c=e.match(/\{%\s*(\w+)\s+([^%]+)\s*%\}/);if(!c){console.warn("Format shortcode invalide dans code block");return}let[,a,p]=c;try{let n=h(p),l=this.renderer.render(a,n);l&&t.appendChild(l)}catch(n){console.error("Erreur parsing shortcode:",n)}}processElement(e,t){console.log("Processing element:",e),this.processNodeRecursively(e)}processNodeRecursively(e){if(e.nodeType===Node.TEXT_NODE){let r=e;if(r.textContent&&this.containsShortcode(r.textContent)){this.processTextNode(r);return}}Array.from(e.childNodes).forEach(r=>this.processNodeRecursively(r))}containsShortcode(e){let t=/\{%.*%\}/.test(e);return t&&console.log("Found shortcode in text:",e),t}processTextNode(e){let t=e.textContent||"",r=[],s=0;C.lastIndex=0;let i;for(;(i=C.exec(t))!==null;){i.index>s&&r.push(t.slice(s,i.index));let[c,a,p]=i,n=this.parseAndRender(a,p);n?r.push(n):r.push(c),s=i.index+c.length}if(s<t.length&&r.push(t.slice(s)),r.length>1||r.length===1&&typeof r[0]!="string"){let c=e.parentNode;c&&(r.forEach(a=>{typeof a=="string"?a.trim()&&c.insertBefore(document.createTextNode(a),e):c.insertBefore(a,e)}),c.removeChild(e))}}parseAndRender(e,t){try{let r=h(t);return this.renderer.render(e,r)}catch(r){return console.error("Erreur parsing shortcode:",r),null}}};var u=class extends w.Plugin{async onload(){this.processor=new f(this.app),this.registerMarkdownCodeBlockProcessor("image",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("grid",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("video",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("figure",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("imagenote",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("fullpage",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("11ty",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownPostProcessor((e,t)=>{this.processor.processElement(e,t)})}onunload(){}};
