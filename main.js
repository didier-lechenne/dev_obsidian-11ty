/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var g=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var v=(n,e)=>{for(var t in e)g(n,t,{get:e[t],enumerable:!0})},N=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of P(e))!x.call(n,o)&&o!==t&&g(n,o,{get:()=>e[o],enumerable:!(r=M(e,o))||r.enumerable});return n};var w=n=>N(g({},"__esModule",{value:!0}),n);var k={};v(k,{default:()=>h});module.exports=w(k);var b=require("obsidian");var E={col:"--col",printCol:"--print-col",width:"--width",printWidth:"--print-width",printRow:"--print-row",printHeight:"--print-height",alignSelf:"--align-self",alignself:"--align-self","align-self":"--align-self",imgX:"--img-x",imgY:"--img-y",imgW:"--img-w",page:"--pagedjs-full-page"},C=/\{%\s*(\w+)\s+([^%]+)\s*%\}/g,T=["image","grid","video","figure","imagenote","fullpage"];function A(n){let e={};return Object.entries(n).forEach(([t,r])=>{if(E[t]&&r!==void 0&&r!==null&&r!==""){let o=typeof r=="string"?r.replace(/^["']|["']$/g,""):r;e[E[t]]=o}}),e}function l(n,e){let t=A(e);Object.entries(t).forEach(([r,o])=>{n.style.setProperty(r,o)})}function p(n){return n?n.replace(/\*([^*]+)\*/g,"$1").replace(/<[^>]+>/g," ").replace(/&[^;]+;/g," ").replace(/\s+/g," ").trim():""}function d(n){return n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>")}function f(n){n=n.trim();let e=n.match(/^["']([^"']+)["'](?:\s*,\s*(\{.*\}))?$/);if(!e)throw new Error("Format de param\xE8tres invalide");let t=e[1],r={};if(e[2])try{let o=e[2].replace(/,(\s*[}\]])/g,"$1");r=Function(`"use strict"; return (${o})`)()}catch(o){console.warn("Erreur parsing options:",o),r={}}return{src:t,options:r}}var m=class{constructor(e){this.app=e;this.globalElementCounter=0}render(e,t){if(!T.includes(e))return console.warn(`Type de shortcode non support\xE9: ${e}`),null;let{src:r,options:o={}}=t,s={src:this.resolveImagePath(r),...o};switch(e){case"image":return this.createImageElement(s);case"grid":return this.createGridElement(s);case"video":return this.createVideoElement(s);case"figure":return this.createFigureElement(s);case"imagenote":return this.createImageNoteElement(s);case"fullpage":return this.createFullPageElement(s);default:return null}}resolveImagePath(e){if(!e)return"";if(e.startsWith("http")||e.startsWith("app://"))return e;let t=this.app.metadataCache.getFirstLinkpathDest(e,"");return t?this.app.vault.getResourcePath(t):`app://local/${encodeURIComponent(e)}`}createImageElement(e){this.globalElementCounter++;let t=document.createElement("figure");t.setAttribute("data-id",e.id||""),t.setAttribute("data-src",e.src||""),t.setAttribute("data-grid","image"),t.id=`image-${this.globalElementCounter}`,t.className=`figure image${e.class?" "+e.class:""}`;let r=document.createElement("img");if(r.src=e.src||"",r.alt=p(e.caption||""),t.appendChild(r),e.caption){let o=document.createElement("figcaption");o.className="figcaption",o.innerHTML=d(e.caption),t.appendChild(o)}return l(t,e),t}createGridElement(e){this.globalElementCounter++;let t=document.createElement("figure");t.setAttribute("data-id",e.id||""),t.setAttribute("data-src",e.src||""),t.setAttribute("data-grid","image"),t.id=`figure-${this.globalElementCounter}`,t.className=e.class||"";let r=document.createElement("img");if(r.src=e.src||"",r.alt=p(e.caption||""),t.appendChild(r),l(t,e),e.caption){let o=document.createElement("figcaption");o.className=`figcaption figcaption-${this.globalElementCounter}`,o.innerHTML=d(e.caption),l(o,e);let s=document.createElement("div");return s.appendChild(t),s.appendChild(o),s}return t}createVideoElement(e){let t=document.createElement("figure");t.className=`video${e.class?" "+e.class:""}`,t.setAttribute("data-grid","content");let r=document.createElement("video");r.controls=!0,e.poster&&(r.poster=e.poster);let o=document.createElement("source");if(o.src=e.src||"",r.appendChild(o),t.appendChild(r),e.caption){let s=document.createElement("figcaption");s.className="figcaption",s.innerHTML=d(e.caption),t.appendChild(s)}return l(t,e),t}createFigureElement(e){this.globalElementCounter++;let t=document.createElement("div"),r=document.createElement("span");r.className="spanMove figure_call",r.id=`fig-${this.globalElementCounter}-call`;let o=document.createElement("a");o.href=`#fig-${this.globalElementCounter}`,o.textContent=`fig. ${this.globalElementCounter}`,r.appendChild(document.createTextNode("[")),r.appendChild(o),r.appendChild(document.createTextNode("]"));let s=document.createElement("span");s.className=`figure figmove${e.class?" "+e.class:""}`,s.setAttribute("data-src",e.src||""),s.setAttribute("data-grid","image"),s.id=`fig-${this.globalElementCounter}`;let a=document.createElement("img");if(a.src=e.src||"",a.alt=p(e.caption||""),s.appendChild(a),e.caption){let i=document.createElement("span");i.className="figcaption";let c=document.createElement("span");c.className="figure_reference",c.textContent=`[fig. ${this.globalElementCounter}]`,i.appendChild(c),i.appendChild(document.createTextNode(" ")),i.innerHTML+=d(e.caption),s.appendChild(i)}return l(s,e),t.appendChild(r),t.appendChild(s),t}createImageNoteElement(e){let t=document.createElement("span");t.className=`imagenote sideNote${e.class?" "+e.class:""}`,t.setAttribute("data-src",e.src||""),t.setAttribute("data-grid","image");let r=document.createElement("img");if(r.src=e.src||"",r.alt=p(e.caption||""),t.appendChild(r),e.caption){let o=document.createElement("span");o.className="caption",o.innerHTML=d(e.caption),t.appendChild(o)}return l(t,e),t}createFullPageElement(e){this.globalElementCounter++;let t=document.createElement("figure");t.setAttribute("data-id",e.id||""),t.setAttribute("data-src",e.src||""),t.setAttribute("data-grid","image"),t.id=`figure-${this.globalElementCounter}`,t.className=`full-page${e.class?" "+e.class:""}`;let r=document.createElement("img");return r.src=e.src||"",r.alt=p(e.caption||""),t.appendChild(r),l(t,e),t}};var u=class{constructor(e){this.app=e;this.renderer=new m(e)}processCodeBlock(e,t,r){let o=r.language,s="",a={};if(e.trim())try{let c=f(e.trim());s=c.src||"",a=c.options}catch(c){s=e.trim().replace(/['"]/g,"")}let i=this.renderer.render(o,{src:s,options:a});i&&t.appendChild(i)}processElement(e,t){console.log("Processing element:",e),this.processNodeRecursively(e)}processNodeRecursively(e){if(e.nodeType===Node.TEXT_NODE){let r=e;if(r.textContent&&this.containsShortcode(r.textContent)){this.processTextNode(r);return}}Array.from(e.childNodes).forEach(r=>this.processNodeRecursively(r))}containsShortcode(e){let t=/\{%.*%\}/.test(e);return t&&console.log("Found shortcode in text:",e),t}processTextNode(e){let t=e.textContent||"",r=[],o=0;C.lastIndex=0;let s;for(;(s=C.exec(t))!==null;){s.index>o&&r.push(t.slice(o,s.index));let[a,i,c]=s,S=this.parseAndRender(i,c);S?r.push(S):r.push(a),o=s.index+a.length}if(o<t.length&&r.push(t.slice(o)),r.length>1||r.length===1&&typeof r[0]!="string"){let a=e.parentNode;a&&(r.forEach(i=>{typeof i=="string"?i.trim()&&a.insertBefore(document.createTextNode(i),e):a.insertBefore(i,e)}),a.removeChild(e))}}parseAndRender(e,t){try{let r=f(t);return this.renderer.render(e,r)}catch(r){return console.error("Erreur parsing shortcode:",r),null}}};var h=class extends b.Plugin{async onload(){this.processor=new u(this.app),this.registerMarkdownCodeBlockProcessor("image",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("grid",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("video",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("figure",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("imagenote",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownCodeBlockProcessor("fullpage",this.processor.processCodeBlock.bind(this.processor)),this.registerMarkdownPostProcessor((e,t)=>{this.processor.processElement(e,t)})}onunload(){}};
